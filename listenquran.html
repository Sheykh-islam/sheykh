<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Quran Player</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link rel="manifest" href="manifest.json">
  <style>
    body {
      font-family:'Segoe UI',system-ui,sans-serif; background:#f8fafc; min-height:100vh; margin:0;
      display:flex; flex-direction:column; align-items:center;
    }
    .container {
      margin-top:40px;
      padding:24px 7px 17px 7px;
      background:#fff;
      border-radius:23px;
      box-shadow:0 4px 22px #0001;
      min-width:240px; max-width:395px; width:98vw;
      display:flex; flex-direction:column; align-items:center;
    }
    h3 { margin:0 0 21px 0; font-weight:700; font-size:1.09em; color:#2d2f31;}
    .controls {display:flex; gap:9px; align-items:center; margin-bottom:16px; width:100%;}
    select, button {
      font-size:1em; padding:7px 12px; border-radius:8px; border: 1px solid #e6e9f1;
      background:#f3f7fa;
    }
    button.download {
      background:linear-gradient(90deg,#22c55e 80%,#7beeab 100%);
      color:#fff; border:none; margin-left:9px;
      padding:8.5px 14px; font-weight:500;
      box-shadow:0 2px 9px #0001;
      cursor:pointer;
      border-radius:9px;
      font-size:1.05em;
    }
    .row {
      margin-bottom:13px; width:100%; display:flex; flex-direction:row; gap:8px;
      align-items:center; justify-content:space-between;
    }
    .nav-btn {
      border:none; background:#edf7ee;
      color:#22c55e; font-size:1.35em; border-radius:50%;
      width:38px; height:38px; cursor:pointer;
      box-shadow:0px 2px 10px #0001;
      display:flex; align-items:center; justify-content:center;
      transition:background 0.14s;
    }
    .nav-btn:active {background:#c9f9e1;}
    .sura-title {
      font-size:1.09em; font-weight:600; color:#162e1e;
      margin: 0 6px 0 6px; flex:1; text-align:center; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
    }
    select#suraSelect {
      width:98%; border-radius:8px; font-size:1em;
      margin-top:6px; background:#f6fafb;
      border:1px solid #e0e6f1;
      padding:8px 9px;
    }
    /* Кастомный аудио-плеер */
    .custom-audio-controls {
      width:100%; display:flex; align-items:center;
      gap:9px; justify-content:center; margin-top:14px;
      user-select: none;
    }
    .custom-audio-controls button {
      border:none;
      background:#ebf6ef; color:#16a34a;
      font-size:1.17em; border-radius:50%;
      width:32px; height:32px; cursor:pointer;
      transition:background .12s;
      display:flex; align-items:center; justify-content:center;
    }
    .custom-audio-controls button:active { background:#b5efd6; }
    .custom-audio-controls input[type=range] {
      flex:1 1 auto; margin: 0 5px;
      accent-color: #22c55e; height:3px;
      border-radius:4px;
    }
    .custom-audio-controls span {
      font-size:0.93em; width:33px; text-align:right; color:#233;
      user-select: none;
    }
    .footer {margin-top:42px;color:#9a9aa0;font-size:1em;text-align:center;}
    @media (max-width:480px){
      .container {padding:15px 2px 14px 2px;}
      .sura-title { font-size:0.98em;}
      .custom-audio-controls span {font-size: 0.90em; width:28px;}
      .custom-audio-controls button {width:27px;height:27px;font-size:1em;}
    }
  </style>
</head>
<body>

<div class="container">
  <h3>Наслаждайтесь чтением Корана</h3>
  <div class="controls">
    <select id="reciter"></select>
    <button class="download" id="downloadBtn" title="Скачать суру">⬇️</button>
  </div>

  <div class="row">
    <button class="nav-btn" id="prevSura" title="Предыдущая сура">&#8678;</button>
    <span class="sura-title" id="suraTitle"></span>
    <button class="nav-btn" id="nextSura" title="Следующая сура">&#8680;</button>
  </div>
  <select id="suraSelect"></select>

  <!-- Спрятанный аудиотег -->
  <audio id="player" preload="none" style="display:none"></audio>
  <!-- Наш кастомный аудиоплеер -->
  <div class="custom-audio-controls" id="customControls">
    <button id="rewindBtn" title="10 сек назад">⏪</button>
    <button id="playPauseBtn" title="Пуск/Пауза">▶️</button>
    <button id="forwardBtn" title="10 сек вперед">⏩</button>
    <span id="currentTime">0:00</span>
    <input type="range" id="progress" min="0" value="0" step="0.1">
    <span id="duration">0:00</span>
  </div>
</div>
<div class="footer">© 2025 Quran Player · Минимализм</div>

<script>
//============== ДАННЫЕ ===============
const suras = [
"Аль-Фатиха","Аль-Бакара","Аль-Имран","Ан-Ниса","Аль-Маида","Аль-Ан'ам","Аль-А'раф","Аль-Анфаль","Ат-Тауба","Юнус",
"Худ","Юсуф","Ар-Ра’д","Ибрахим","Аль-Хиджр","Ан-Нахль","Аль-Исра","Аль-Кахф","Марьям","Та-Ха",
"Аль-Анбия","Аль-Хадж","Аль-Муминун","Ан-Нур","Аль-Фуркан","Аш-Шуара","Ан-Намль","Аль-Касас","Аль-Анкабут","Ар-Рум",
"Лукман","Ас-Саджда","Аль-Ахзаб","Саба'","Фатыр","Йа Син","Ас-Саффат","Сад","Аз-Зумар","Гафир",
"Фуссылят","Аш-Шура","Аз-Зухруф","Ад-Духан","Аль-Джасия","Аль-Ахкаф","Мухаммад","Аль-Фатх","Аль-Худжурат","Каф",
"Аз-Зарият","Ат-Тур","Ан-Наджм","Аль-Камар","Ар-Рахман","Аль-Ваки’а","Аль-Хадид","Аль-Муджадила","Аль-Хашр","Аль-Мумтахина",
"Ас-Сафф","Аль-Джумуа","Аль-Мунафикун","Ат-Тагабун","Ат-Талак","Ат-Тахрим","Аль-Мульк","Аль-Калам","Аль-Хакка","Аль-Мааридж",
"Нух","Аль-Джинн","Аль-Муззаммиль","Аль-Муддассир","Аль-Кийама","Аль-Инсан","Аль-Мурсилят","Ан-Наба","Ан-Назиат","Абаса",
"Ат-Таквир","Аль-Инфитар","Аль-Мутаффифин","Аль-Иншикак","Аль-Бурудж","Ат-Тарик","Аль-Аъля","Аль-Гашия","Аль-Фаджр","Аль-Балад",
"Аш-Шамс","Аль-Лейль","Ад-Духа","Аль-Инширах","Ат-Тин","Аль-Алак","Аль-Кадр","Аль-Баййина","Аз-Залзаля","Аль-Адият",
"Аль-Кариа","Ат-Такатур","Аль-Аср","Аль-Хумаза","Аль-Филь","Курайш","Аль-Маун","Аль-Каусар","Аль-Кафирун","Ан-Наср",
"Аль-Массад","Аль-Ихляс","Аль-Фаляк","Ан-Нас"
];
const TOTAL_SURAS = suras.length;
const reciters = [
  {
    name: "Абдул Басит Абдул Самад",
    template: (s) => `https://server7.mp3quran.net/basit/Almusshaf-Al-Mojawwad/${s.padStart(3,'0')}.mp3`
  },
  { name: "Абдуллах аль-Матруд", template: (s)=>`https://media.quran-online.ru/recitations/abdullah-matrud/by-sura/${s.padStart(3,'0')}.mp3` },
  { name: "Абубакр аль-Шатри", template: (s)=>`https://media.quran-online.ru/recitations/abu-bakr-al-shatri/by-sura/${s.padStart(3,'0')}.mp3` },
  { name: "Азиз Алили", template: (s)=>`https://media.quran-online.ru/recitations/aziz-alili/by-sura/${s.padStart(3,'0')}.mp3` },
  { name: "Али аль-Хузейфи", template: (s)=>`https://media.quran-online.ru/recitations/ali-abdur-rahman-al-huthaify/by-sura/${s.padStart(3,'0')}.mp3` },
  { name: "Махмуд Халиль аль-Хусари", template: (s)=>`https://media.quran-online.ru/recitations/mahmoud-khaleel-al-husary/reading-muallim/by-sura/${s.padStart(3,'0')}.mp3` },
  { name: "Мишари Рашид", template: (s)=>`https://media.quran-online.ru/recitations/mishari-rashid/by-sura/${s.padStart(3,'0')}.mp3` },
  { name: "Мухаммад аль-Люхайдан", template: (s)=>`https://media.quran-online.ru/recitations/muhammad-al-luhaidan/by-sura/${s.padStart(3,'0')}.mp3` },
  { name: "Мухаммад Сиддик аль-Миншави", template: (s)=>`https://media.quran-online.ru/recitations/muhammad-siddiq-al-minshawi/mujawwad/by-sura/${s.padStart(3,'0')}.mp3` },
  { name: "Нассир аль-Катами", template: (s)=>`https://media.quran-online.ru/recitations/nasser-al-qatami/by-sura/${s.padStart(3,'0')}.mp3` },
  { name: "Саад аль-Гамиди", template: (s)=>`https://media.quran-online.ru/recitations/saad-al-ghamdi/by-sura/${s.padStart(3,'0')}.mp3` },
  { name: "Салах аль-Хашими", template: (s)=>`https://media.quran-online.ru/recitations/salah-al-hashim/by-sura/${s.padStart(3,'0')}.mp3` },
  { name: "Салах Бухатир", template: (s)=>`https://media.quran-online.ru/recitations/salah-bukhatir/by-sura/${s.padStart(3,'0')}.mp3` },
  { name: "Сауд аш-Шурейм", template: (s)=>`https://media.quran-online.ru/recitations/saood-bin-ibraaheem-ash-shuraym/by-sura/${s.padStart(3,'0')}.mp3` },
  { name: "Тауфик ибн Санд ас-Сауаих", template: (s)=>`https://media.quran-online.ru/recitations/tawfeeq-ibn-said-as-sawaigh/by-sura/${s.padStart(3,'0')}.mp3` },
  { name: "Ясир ад даусари", template: (s)=>`https://media.quran-online.ru/recitations/yasser-ad-dussary/by-sura/${s.padStart(3,'0')}.mp3` }
];
const DEFAULT_RECITER = 9;

let currentReciter = +localStorage.getItem("reciter") || DEFAULT_RECITER;
let currentSura    = 1;
const reciterSelect = document.getElementById('reciter');
const suraSelect    = document.getElementById('suraSelect');
const suraTitle     = document.getElementById('suraTitle');
const prevBtn       = document.getElementById('prevSura');
const nextBtn       = document.getElementById('nextSura');
const downloadBtn   = document.getElementById('downloadBtn');

// == Чтецы
reciters.forEach((r,i)=>{
  let opt = document.createElement('option');
  opt.textContent = r.name;
  opt.value = i;
  reciterSelect.appendChild(opt);
});
reciterSelect.selectedIndex = currentReciter;

// == Суры
suraSelect.innerHTML = '';
for(let i=0; i<TOTAL_SURAS; ++i){
  let opt = document.createElement('option');
  opt.value = i+1;
  opt.textContent = (i+1) + ". " + suras[i];
  suraSelect.appendChild(opt);
}

// == Audio player logic
function getAudioLink(reciterIdx, suraNum){
  return reciters[reciterIdx].template(String(suraNum).padStart(3,'0'));
}
function updatePlayer() {
  suraSelect.selectedIndex = currentSura-1;
  suraTitle.textContent = (currentSura) + ". " + suras[currentSura-1];
  const link = getAudioLink(currentReciter,currentSura);
  player.src = link;
}

reciterSelect.onchange = e => {
  currentReciter = +e.target.value;
  localStorage.setItem("reciter", currentReciter);
  updatePlayer();
  customPause();
};
suraSelect.onchange = e => {
  currentSura = +e.target.value;
  updatePlayer();
  customPause();
};
prevBtn.onclick=()=>{
  currentSura = currentSura>1 ? currentSura-1 : TOTAL_SURAS;
  updatePlayer(); customPause();
};
nextBtn.onclick=()=>{
  currentSura = currentSura<TOTAL_SURAS ? currentSura+1 : 1;
  updatePlayer(); customPause();
};
downloadBtn.onclick = ()=>{
  const link = getAudioLink(currentReciter, currentSura);
  const name = `Сура_${currentSura}.mp3`;
  const a = document.createElement('a');
  a.href = link;
  a.download = name;
  document.body.appendChild(a);
  a.click(); document.body.removeChild(a);
};
suraSelect.selectedIndex = currentSura-1;
updatePlayer();

// Кастомный плеер
const player = document.getElementById('player');
const playPauseBtn = document.getElementById('playPauseBtn');
const rewindBtn = document.getElementById('rewindBtn');
const forwardBtn = document.getElementById('forwardBtn');
const progress = document.getElementById('progress');
const currentTimeElem = document.getElementById('currentTime');
const durationElem = document.getElementById('duration');

playPauseBtn.onclick = ()=>{
  if (player.paused) player.play();
  else player.pause();
};
player.onplay = ()=>{ playPauseBtn.innerText = "⏸️"; };
player.onpause = ()=>{ playPauseBtn.innerText = "▶️"; };

// -10/+10
rewindBtn.onclick = ()=>{ player.currentTime = Math.max(player.currentTime-10,0);}
forwardBtn.onclick = ()=>{ player.currentTime = Math.min(player.currentTime+10, player.duration||0);}
player.ontimeupdate = ()=>{
  progress.value = player.currentTime;
  currentTimeElem.textContent = formatTime(player.currentTime);
};
player.onloadedmetadata = ()=>{
  progress.max = player.duration||0;
  durationElem.textContent = formatTime(player.duration);
};
progress.oninput = ()=>{ player.currentTime = parseFloat(progress.value);}
function formatTime(sec){
  sec=Math.floor(sec)||0;let m=Math.floor(sec/60),s=sec%60;
  return m+':'+(s<10?'0':'')+s;
}
// сброс play при смене суры
function customPause() {
    player.pause();
    player.currentTime = 0;
    progress.value = 0;
    playPauseBtn.innerText = '▶️';
    currentTimeElem.textContent = "0:00";
    durationElem.textContent = "0:00";
}
customPause();

// ============= Service Worker для кеша ============
if('serviceWorker' in navigator){
  window.addEventListener('load',()=> {
    navigator.serviceWorker.register('./sw.js');
  });
}
</script>
</body>
</html>
